<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<title>ãƒ©ãƒ³ãƒ€ãƒ ã‚«ãƒ—ãƒ¡ãƒ¼ã‚«ãƒ¼</title>
<style>
    :root {
        --bg: #ffffff;
        --card-bg: #fdfdfd;
        --border: #e0e0e0;
        --text: #1a1a1a;
        --accent: #000000;
        --secondary: #f4f4f4;
        --muted: #757575;
    }

    body {
        font-family: "Helvetica Neue", Arial, "Hiragino Kaku Gothic ProN", "Hiragino Sans", Meiryo, sans-serif;
        background: var(--bg);
        color: var(--text);
        padding: 40px 20px;
        line-height: 1.6;
        max-width: 900px;
        margin: 0 auto;
    }

    h1, h2, h3 {
        font-weight: 600;
        letter-spacing: 0.05em;
        margin-bottom: 15px;
    }

    h1 { text-align: center; margin-bottom: 40px; }

    .btn-group { text-align: center; margin-bottom: 30px; }

    button {
        background: var(--accent);
        color: white;
        border: 1px solid var(--accent);
        padding: 10px 20px;
        border-radius: 4px;
        cursor: pointer;
        font-size: 14px;
        transition: all 0.2s;
        margin: 4px;
    }

    button:hover { opacity: 0.7; }
    
    .roll-btn {
        background: white;
        color: var(--text);
        border: 1px solid var(--border);
        padding: 2px 8px;
        font-size: 11px;
        margin-left: 8px;
    }
    .roll-btn:hover { background: var(--secondary); }

    .secondary-btn { background: var(--muted); border-color: var(--muted); }

    .row {
        display: flex;
        gap: 24px;
        margin-bottom: 24px;
        flex-wrap: wrap;
    }

    .card {
        flex: 1;
        min-width: 300px;
        background: var(--card-bg);
        border: 1px solid var(--border);
        padding: 24px;
    }

    .result-box {
        margin-bottom: 12px;
        padding-bottom: 8px;
        border-bottom: 1px solid var(--secondary);
        display: flex;
        align-items: center;
        justify-content: space-between;
    }

    .result-label { font-size: 12px; color: var(--muted); min-width: 60px; }
    .result-val { font-weight: bold; font-size: 16px; flex-grow: 1; margin-left: 10px;}

    select {
        padding: 4px;
        border: 1px solid var(--border);
        border-radius: 4px;
        font-size: 14px;
        background: #fff;
    }

    textarea {
        width: 100%;
        box-sizing: border-box;
        padding: 10px;
        border: 1px solid var(--border);
        border-radius: 2px;
        font-size: 14px;
        background: #fff;
        overflow: hidden;
        resize: none;
        min-height: 40px;
        display: block;
    }

    input[type="text"] {
        width: 100%;
        box-sizing: border-box;
        padding: 8px;
        border: 1px solid var(--border);
        font-size: 14px;
        margin-bottom: 10px;
    }

    .section {
        margin-top: 40px;
        border-top: 2px solid var(--accent);
        padding-top: 24px;
        margin-bottom: 20px;
    }

    .item-box {
        background: var(--secondary);
        padding: 15px;
        margin-bottom: 15px;
        position: relative;
    }

    .detail-grid {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 20px;
    }
    .detail-title {
        font-weight: bold;
        font-size: 14px;
        margin-top: 15px;
        margin-bottom: 5px;
        display: block;
    }

    /* è¨­å®šã‚¨ãƒªã‚¢å°‚ç”¨ã‚¹ã‚¿ã‚¤ãƒ« */
    .master-data {
        margin-top: 80px;
        padding: 20px;
        background: #f9f9f9;
        font-size: 12px;
        border: 1px dashed #ccc;
    }
    .master-data textarea {
        resize: vertical; /* æ‰‹å‹•ãƒªã‚µã‚¤ã‚ºã‚’æœ‰åŠ¹åŒ– */
        min-height: 120px;
        overflow-y: auto; /* é•·ããªã£ãŸã‚‰ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«å¯èƒ½ã« */
    }
</style>
</head>
<body>

<h1>ğŸ² ãƒ©ãƒ³ãƒ€ãƒ ã‚«ãƒ—ãƒ¡ãƒ¼ã‚«ãƒ¼</h1>

<div class="btn-group">
    <button onclick="rollAll()" style="font-size: 18px; padding: 15px 40px;">ã™ã¹ã¦ãƒ©ãƒ³ãƒ€ãƒ ã«æ±ºå®š</button>
</div>

<div class="row">
    <div class="card">
        <h2>CHARACTER 1</h2>
        <div class="result-box">
            <span class="result-label">æ€§åˆ¥</span>
            <select id="gender1" style="flex-grow: 1; margin-left: 10px;">
                <option value="ç”·æ€§">ç”·æ€§</option>
                <option value="å¥³æ€§">å¥³æ€§</option>
                <option value="ä¸­æ€§">ä¸­æ€§</option>
            </select>
        </div>
        <div class="result-box">
            <span class="result-label">å±æ€§</span>
            <div class="result-val" id="attr1">-</div>
            <button class="roll-btn" onclick="rollGenderAttr(1)">å¼•ã</button>
        </div>
        <div class="result-box">
            <span class="result-label">è‚©æ›¸ã</span>
            <div class="result-val" id="title1">-</div>
            <button class="roll-btn" onclick="slot('title1', masterData.title)">å¼•ã</button>
        </div>
        <div class="result-box">
            <span class="result-label">æƒ³ã„</span>
            <div class="result-val" id="feel1">-</div>
            <button class="roll-btn" onclick="slot('feel1', masterData.feel)">å¼•ã</button>
        </div>
        <textarea class="save-target auto-resize" data-label="C1ãƒ¡ãƒ¢" placeholder="è‡ªç”±ãƒ¡ãƒ¢"></textarea>
    </div>

    <div class="card">
        <h2>CHARACTER 2</h2>
        <div class="result-box">
            <span class="result-label">æ€§åˆ¥</span>
            <select id="gender2" style="flex-grow: 1; margin-left: 10px;">
                <option value="ç”·æ€§">ç”·æ€§</option>
                <option value="å¥³æ€§">å¥³æ€§</option>
                <option value="ä¸­æ€§">ä¸­æ€§</option>
            </select>
        </div>
        <div class="result-box">
            <span class="result-label">å±æ€§</span>
            <div class="result-val" id="attr2">-</div>
            <button class="roll-btn" onclick="rollGenderAttr(2)">å¼•ã</button>
        </div>
        <div class="result-box">
            <span class="result-label">è‚©æ›¸ã</span>
            <div class="result-val" id="title2">-</div>
            <button class="roll-btn" onclick="slot('title2', masterData.title)">å¼•ã</button>
        </div>
        <div class="result-box">
            <span class="result-label">æƒ³ã„</span>
            <div class="result-val" id="feel2">-</div>
            <button class="roll-btn" onclick="slot('feel2', masterData.feel)">å¼•ã</button>
        </div>
        <textarea class="save-target auto-resize" data-label="C2ãƒ¡ãƒ¢" placeholder="è‡ªç”±ãƒ¡ãƒ¢"></textarea>
    </div>
</div>

<div class="section">
    <h2>äºŒäººã®é–¢ä¿‚æ€§</h2>
    <textarea class="save-target auto-resize" data-label="äºŒäººã®é–¢ä¿‚æ€§" placeholder="é–¢ä¿‚æ€§ã®è©³ç´°ã‚’å…¥åŠ›..."></textarea>
</div>

<div class="section">
    <h2>æ·±æ˜ã‚Šè³ªå•</h2>
    <button class="secondary-btn" onclick="addExtra('deep')">ï¼‹ è³ªå•ã‚’å¼•ã</button>
    <div id="deep-container"></div>
</div>

<div class="section">
    <h2>å‡ºæ¥äº‹</h2>
    <button class="secondary-btn" onclick="addExtra('event')">ï¼‹ å‡ºæ¥äº‹ã‚’å¼•ã</button>
    <div id="event-container"></div>
</div>

<div class="section">
    <h2>ç´°ã‹ã„è¨­å®š</h2>
    <div class="detail-grid">
        <div>
            <h3>CHARACTER 1</h3>
            <span class="detail-title">åå‰</span><input type="text" class="save-target" data-label="C1åå‰">
            <span class="detail-title">ä¸€äººç§°</span><textarea class="save-target auto-resize" data-label="C1ä¸€äººç§°"></textarea>
            <span class="detail-title">äºŒäººç§°</span><textarea class="save-target auto-resize" data-label="C1äºŒäººç§°"></textarea>
            <span class="detail-title">ç›¸æ‰‹ã‹ã‚‰ã®å‘¼ã°ã‚Œæ–¹</span><textarea class="save-target auto-resize" data-label="C1è¢«å‘¼ç§°"></textarea>
            <span class="detail-title">è¦‹ãŸç›®</span><textarea class="save-target auto-resize" data-label="C1å¤–è¦‹"></textarea>
            <span class="detail-title">å£èª¿</span><textarea class="save-target auto-resize" data-label="C1å£èª¿"></textarea>
        </div>
        <div>
            <h3>CHARACTER 2</h3>
            <span class="detail-title">åå‰</span><input type="text" class="save-target" data-label="C2åå‰">
            <span class="detail-title">ä¸€äººç§°</span><textarea class="save-target auto-resize" data-label="C2ä¸€äººç§°"></textarea>
            <span class="detail-title">äºŒäººç§°</span><textarea class="save-target auto-resize" data-label="C2äºŒäººç§°"></textarea>
            <span class="detail-title">ç›¸æ‰‹ã‹ã‚‰ã®å‘¼ã°ã‚Œæ–¹</span><textarea class="save-target auto-resize" data-label="C2è¢«å‘¼ç§°"></textarea>
            <span class="detail-title">è¦‹ãŸç›®</span><textarea class="save-target auto-resize" data-label="C2å¤–è¦‹"></textarea>
            <span class="detail-title">å£èª¿</span><textarea class="save-target auto-resize" data-label="C2å£èª¿"></textarea>
        </div>
    </div>
</div>

<div class="btn-group" style="margin-top: 60px;">
    <button onclick="saveText()" style="background: #000; padding: 20px 50px; font-weight: bold;">ğŸ’¾ ãƒšãƒ¼ã‚¸ã‚’ä¿å­˜ï¼ˆ.txtï¼‰</button>
    <button class="secondary-btn" onclick="copyToClipboard()">ğŸ“‹ ã‚³ãƒ”ãƒ¼</button>
</div>

<div class="master-data">
    <h3>âš™ï¸ æŠ½é¸é …ç›®ã®ç·¨é›†</h3>
    <p>æ”¹è¡ŒåŒºåˆ‡ã‚Šã§å…¥åŠ›ã—ã¦ãã ã•ã„ã€‚å³ä¸‹ã‚’ãƒ‰ãƒ©ãƒƒã‚°ã—ã¦åºƒã’ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚</p>
    <div style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 10px;">
        <div>å±æ€§ï¼ˆç”·æ€§ï¼‰<textarea id="master-attr-male" oninput="updateMaster()">ç†±è¡€&#13;ç´³å£«çš„&#13;ä¿ºæ§˜&#13;ä¸å™¨ç”¨</textarea></div>
        <div>å±æ€§ï¼ˆå¥³æ€§ï¼‰<textarea id="master-attr-female" oninput="updateMaster()">æ¸…æ¥š&#13;ãƒ„ãƒ³ãƒ‡ãƒ¬&#13;ãŠå§‰æ§˜&#13;å‹æ°—</textarea></div>
        <div>å±æ€§ï¼ˆä¸­æ€§ï¼‰<textarea id="master-attr-neu" oninput="updateMaster()">ãƒŸã‚¹ãƒ†ãƒªã‚¢ã‚¹&#13;ä¸­æ€§çš„&#13;ç„¡å¢&#13;é”è¦³</textarea></div>
    </div>
    <div style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 10px; margin-top: 10px;">
        <div>è‚©æ›¸ã<textarea id="master-title" oninput="updateMaster()">å­¦ç”Ÿ&#13;æ¢åµ&#13;ä½œå®¶&#13;åº—å“¡</textarea></div>
        <div>æƒ³ã„<textarea id="master-feel" oninput="updateMaster()">ç‰‡æƒ³ã„&#13;ä¿¡é ¼&#13;åŸ·ç€</textarea></div>
    </div>
    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin-top: 10px;">
        <div>æ·±æ˜ã‚Šè³ªå•<textarea id="master-deep" oninput="updateMaster()">å¼±ç‚¹ã¯ï¼Ÿ&#13;å¥½ããªéƒ¨ä½ã¯ï¼Ÿ</textarea></div>
        <div>å‡ºæ¥äº‹<textarea id="master-event" oninput="updateMaster()">å¶ç„¶ã®å†ä¼š&#13;é›¨ã®æ—¥ã®äº‹ä»¶</textarea></div>
    </div>
</div>

<script>
const storeKeyMaster = "cp_game_master_v4";
let masterData = {};

function adjustHeight(el) {
    // ç·¨é›†ã‚¨ãƒªã‚¢ï¼ˆmaster-dataå†…ï¼‰ã®textareaã¯è‡ªå‹•ãƒªã‚µã‚¤ã‚ºã‚’ã‚¹ã‚­ãƒƒãƒ—ï¼ˆæ‰‹å‹•ãƒªã‚µã‚¤ã‚ºã‚’å„ªå…ˆï¼‰
    if (el.closest('.master-data')) return;

    el.style.height = 'auto';
    el.style.height = el.scrollHeight + 'px';
}

document.addEventListener('input', e => {
    if (e.target.tagName.toLowerCase() === 'textarea') adjustHeight(e.target);
});

window.onload = () => {
    const savedMaster = localStorage.getItem(storeKeyMaster);
    if (savedMaster) {
        masterData = JSON.parse(savedMaster);
        document.getElementById('master-attr-male').value = masterData.attrMale.join('\n');
        document.getElementById('master-attr-female').value = masterData.attrFemale.join('\n');
        document.getElementById('master-attr-neu').value = masterData.attrNeu.join('\n');
        document.getElementById('master-title').value = masterData.title.join('\n');
        document.getElementById('master-feel').value = masterData.feel.join('\n');
        document.getElementById('master-deep').value = masterData.deep.join('\n');
        document.getElementById('master-event').value = masterData.event.join('\n');
    } else {
        updateMaster();
    }
};

function updateMaster() {
    masterData = {
        attrMale: document.getElementById('master-attr-male').value.split('\n').filter(v => v),
        attrFemale: document.getElementById('master-attr-female').value.split('\n').filter(v => v),
        attrNeu: document.getElementById('master-attr-neu').value.split('\n').filter(v => v),
        title: document.getElementById('master-title').value.split('\n').filter(v => v),
        feel: document.getElementById('master-feel').value.split('\n').filter(v => v),
        deep: document.getElementById('master-deep').value.split('\n').filter(v => v),
        event: document.getElementById('master-event').value.split('\n').filter(v => v)
    };
    localStorage.setItem(storeKeyMaster, JSON.stringify(masterData));
}

function slot(id, list) {
    const el = document.getElementById(id);
    let count = 0;
    const interval = setInterval(() => {
        el.textContent = list[Math.floor(Math.random() * list.length)];
        count++;
        if (count > 10) clearInterval(interval);
    }, 40);
}

function rollGenderAttr(num) {
    const gender = document.getElementById(`gender${num}`).value;
    let list;
    if (gender === 'ç”·æ€§') list = masterData.attrMale;
    else if (gender === 'å¥³æ€§') list = masterData.attrFemale;
    else list = masterData.attrNeu;
    slot(`attr${num}`, list);
}

function rollAll() {
    rollGenderAttr(1); slot('title1', masterData.title); slot('feel1', masterData.feel);
    rollGenderAttr(2); slot('title2', masterData.title); slot('feel2', masterData.feel);
}

function addExtra(type) {
    const container = document.getElementById(`${type}-container`);
    const list = masterData[type];
    const text = list[Math.floor(Math.random() * list.length)];
    const div = document.createElement('div');
    div.className = 'item-box';
    div.innerHTML = `
        <strong>${text}</strong>
        <textarea class="save-target auto-resize" data-label="${type === 'deep' ? 'è³ªå•' : 'å‡ºæ¥äº‹'}: ${text}" style="margin-top:10px"></textarea>
        <button class="roll-btn" style="position:absolute; top:10px; right:10px" onclick="this.parentElement.remove()">å‰Šé™¤</button>
    `;
    container.appendChild(div);
}

function buildExportText() {
    let txt = "ã€ãƒ©ãƒ³ãƒ€ãƒ ã‚«ãƒ—è¨­å®šã€‘\n\n";
    for(let i=1; i<=2; i++){
        const g = document.getElementById(`gender${i}`).value;
        const a = document.getElementById(`attr${i}`).textContent;
        const t = document.getElementById(`title${i}`).textContent;
        const f = document.getElementById(`feel${i}`).textContent;
        if(a !== "-") txt += `CHARACTER ${i}: [${g}] ${a} / ${t} / æƒ³ã„: ${f}\n`;
    }
    txt += "\n";

    document.querySelectorAll('.save-target').forEach(el => {
        const label = el.getAttribute('data-label');
        const val = el.value.trim();
        if (val) txt += `â–  ${label}\n${val}\n\n`;
    });
    return txt.trim();
}

function saveText() {
    const txt = buildExportText();
    const blob = new Blob([txt], {type: "text/plain"});
    const a = document.createElement("a");
    a.href = URL.createObjectURL(blob);
    a.download = `cp_setting.txt`;
    a.click();
}

function copyToClipboard() {
    const txt = buildExportText();
    navigator.clipboard.writeText(txt).then(() => alert("ã‚³ãƒ”ãƒ¼ã—ã¾ã—ãŸ"));
}
</script>

</body>
</html>
